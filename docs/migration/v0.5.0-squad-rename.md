# Migration Guide: .ai-team/ → .squad/ (v0.5.0)

In Squad v0.5.0, the team state directory is renamed from `.ai-team/` to `.squad/`. This guide walks you through the migration process and explains what changed.

---

## What Changed?

| Item | v0.4.x | v0.5.0+ | Impact |
|------|--------|---------|--------|
| **Team directory** | `.ai-team/` | `.squad/` | Directory rename |
| **Content** | Same structure | Same structure | No file format changes |
| **Git history** | All history in `.ai-team/` | Email scrubbing applied (see below) | Commit history cleaned |
| **Migration command** | N/A | `squad upgrade --migrate-directory` | One-command upgrade |

---

## Before You Migrate

### Backup (Recommended)

While the migration is safe, it's a good idea to back up your repo first:

```bash
# Create a backup branch before migrating
git checkout -b backup/pre-squad-0.5.0-migration
git push origin backup/pre-squad-0.5.0-migration
```

### Check Your Squad Version

```bash
npx github:bradygaster/squad --version
```

If you're on v0.4.x, continue to the migration steps below. If you're on v0.5.0+, your repo may already be migrated.

---

## Migration Steps

### 1. Pull the Latest Squad

```bash
npx github:bradygaster/squad upgrade
```

This updates your Squad coordinator and templates to v0.5.0+. Your `.ai-team/` directory is not touched yet.

### 2. Run the Migration Command

```bash
npx github:bradygaster/squad upgrade --migrate-directory
```

This command:
- Renames `.ai-team/` to `.squad/` in your working directory
- Scrubs personally identifiable information (emails) from file contents
- Updates `.gitattributes` to reference the new `.squad/` paths
- Stages changes for commit

### 3. Review and Commit

```bash
# Check what changed
git status
git diff --staged

# If everything looks good, commit
git commit -m "chore: migrate .ai-team/ → .squad/ (#105)"

# Push to your development branch
git push origin your-branch
```

---

## What Gets Scrubbed?

The migration automatically removes personally identifiable information from your Squad state:

### Scrubbed Content
- **Email addresses** — All email patterns (name@domain.com) are removed from:
  - `team.md` (contributor field)
  - `decisions.md` (author fields)
  - `agents/*/history.md` (session metadata)
  - `log/` files (user context)

### Preserved Content
- Agent names, charters, and expertise
- All decisions and knowledge
- Full commit history (emails in historical commits remain until you use `git filter-repo`)

### Git History Note

The migration renames the directory but doesn't rewrite git history. Email addresses in old commits still appear in `git log`. To fully clean email addresses from your git history (including commits), use `git filter-repo`:

```bash
# Install git filter-repo (if not already installed)
pip install git-filter-repo

# Remove email addresses from all commits
git filter-repo --mailmap <(echo 'YOUR_EMAIL <noreply@example.com>')
```

**⚠️ Warning:** `git filter-repo` rewrites history and requires a force push. Only use this if you're comfortable with destructive git operations, and coordinate with your team if others are working on the repo.

---

## Backward Compatibility During Migration

### During v0.5.0–v0.6.0 (Transition Period)

Squad v0.5.0 and v0.5.x support **both `.ai-team/` and `.squad/`** to help you transition gradually:

```
If both exist:
  → Squad uses `.squad/` (new)
  → `.ai-team/` triggers deprecation warning

If only `.ai-team/` exists:
  → Squad uses `.ai-team/` (backward compat)
  → Deprecation warning shown

If only `.squad/` exists:
  → Squad uses `.squad/` (expected post-migration)
  → No warning
```

**Deprecation warning example:**
```
⚠️  .ai-team/ found but .squad/ is the new location.
    Run `squad upgrade --migrate-directory` to migrate.
    .ai-team/ support will be removed in v1.0.0.
```

### Gradual Migration Strategy

You don't have to migrate all at once:

1. **Upgrade to v0.5.0** — get latest features, keep `.ai-team/` working
2. **Test in staging** — create a test branch with `.squad/` to verify everything works
3. **Migrate when ready** — run `--migrate-directory` on your main branch
4. **Deprecation buffer** — v0.5.0 through v0.6.0 support both; migration becomes required in v1.0.0

---

## Troubleshooting

### Q: The migration command doesn't exist. What do I do?

**A:** You're on v0.4.x. Update Squad first:

```bash
npx github:bradygaster/squad upgrade
npx github:bradygaster/squad upgrade --migrate-directory
```

### Q: The migration ran but I can't see `.squad/` directory.

**A:** The directory was created and the changes are staged for commit. Check git status:

```bash
git status  # Should show .squad/ and .ai-team/ removed
git diff --staged  # Shows the changes
```

If nothing appears, the directory may not have needed migration (already using `.squad/`).

### Q: I accidentally deleted `.ai-team/`. How do I recover?

**A:** Git has your back. Assuming you haven't committed the deletion yet:

```bash
git checkout HEAD -- .ai-team/
```

If you committed it, use git log to find the commit and reset:

```bash
git log --oneline -- .ai-team  # Find the deletion commit
git checkout <commit_hash>^ -- .ai-team  # Restore from before deletion
```

### Q: The migration scrubbed emails. Can I undo it?

**A:** Yes, the original emails are in your git history. To restore them:

```bash
git log --all --full-history -p -- .squad/team.md  # Find original version
git checkout <commit_hash>:.squad/team.md > temp.txt  # Extract original
# Manually copy relevant sections back
```

Or, revert the entire migration commit:

```bash
git revert <migration_commit_hash>
```

### Q: Do I have to migrate? What if I don't?

**A:** Not yet. Squad v0.5.0–v0.6.0 support `.ai-team/` with a deprecation warning. Migration becomes required in v1.0.0 (estimated v1.0.0 release: Q3 2026). Plan to migrate during a routine upgrade cycle.

---

## After Migration

### Verify Everything Works

1. **Run tests** — your tests still reference old paths but have been updated:

   ```bash
   npm test
   ```

2. **Check git status** — confirm `.squad/` exists and `.ai-team/` is removed:

   ```bash
   ls -la .squad/
   git status
   ```

3. **Start a session** — initialize a Squad session to confirm agents load correctly:

   ```bash
   copilot
   > /agent
   > (select Squad)
   > Your team status check?
   ```

4. **Review decisions** — confirm `.squad/decisions.md` exists and is readable:

   ```bash
   head -50 .squad/decisions.md
   ```

### Update References in Your Codebase

If your project has custom documentation or scripts that reference `.ai-team/`, update them to `.squad/`:

```bash
# Search for .ai-team references in your project
grep -r "\.ai-team" --include="*.md" --include="*.sh" --include="*.yml" .

# Replace with .squad
sed -i 's/\.ai-team/\.squad/g' your-file.md
```

### Communicate with Your Team

If you're working in a team repo:

1. **Announce the migration** — let teammates know the directory has been renamed
2. **Share the migration guide** — point them to this document
3. **Coordinate timing** — if multiple branches exist, migrate before merging to avoid conflicts
4. **Test on a branch first** — create a feature branch, migrate, test, then merge back to dev

---

## What This Means for Your Workflow

### Before Migration (v0.4.x)
```bash
.ai-team/
├── team.md
├── agents/ripley/history.md
├── decisions.md
└── log/
```

### After Migration (v0.5.0+)
```bash
.squad/
├── team.md
├── agents/ripley/history.md
├── decisions.md
└── log/
```

**Everything else stays the same.** Your agent knowledge, decisions, and session history all transfer — only the directory name changes.

---

## Timeline

| Version | Status | .ai-team/ Support | Action Required |
|---------|--------|-------------------|-----------------|
| **v0.4.x** | Current | ✅ Only option | None (existing repos) |
| **v0.5.0+** | Latest | ✅ With deprecation warning | Run `--migrate-directory` (optional) |
| **v0.6.0+** | Future | ✅ With stronger warning | Plan migration (still optional) |
| **v1.0.0** | Future | ❌ Removed | Migrate before upgrading (required) |

---

## Questions?

- **Migration issues?** [Open an issue](https://github.com/bradygaster/squad/issues) with details
- **General questions?** Ask in [GitHub Discussions](https://github.com/bradygaster/squad/discussions)
- **Security concerns?** Report privately via [GitHub Security Advisory](https://github.com/bradygaster/squad/security/advisories)

---

**Version:** v0.5.0  
**Last Updated:** 2026-02  
**Status:** Final
